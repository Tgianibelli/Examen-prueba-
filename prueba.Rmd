---
title: "Análisis LAPOP - Formalidad/Informalidad"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Prendo las librerías necesarias 

```{r}
library(tidyverse)
library(haven)
library(ggthemes)
```

# Importando, limpiando y transformando datos 

Guardo como objeto los .dta correspondientes a los 4 países seleccionados para realizar el trabajo (Argentina, Brasil, Chile y Uruguay)

```{r}
Argentina <- read_dta('~/Desktop/DATA/LAPOP Argentina.dta')
Brasil <- read_dta('~/Desktop/DATA/LAPOP Brasil.dta')
Chile <- read_dta('~/Desktop/DATA/LAPOP Chile.dta')
Uruguay <- read_dta('~/Desktop/DATA/LAPOP Uruguay.dta')
```

Limpio los 4 dataframes de las variables que no voy a utilizar y los guardo nuevamente como objetos

```{r}
Argentinac <- select(Argentina, uniq_id, formal, pais, a4, l1, prot3, b21, ros4, redist1, redist2a, redist3, pn4, vb10, pol1)
Brasilc <- select(Brasil, uniq_id, formal, pais, a4, l1, prot3, b21, ros4, redist1, redist2a, redist3, pn4, vb10, pol1)
Chilec <- select(Chile, uniq_id, formal, pais, a4, l1, prot3, b21, ros4, redist1, redist2a, redist3, pn4, vb10, pol1)
Uruguayc <- select(Uruguay, uniq_id, formal, pais, a4, l1, prot3, b21, ros4, redist1, redist2a, redist3, pn4, vb10, pol1)
```

Unifico verticalmente los 4 dataframes en un solo objeto y limpiamos el _environment_ 

```{r}
Base <- bind_rows(Argentinac, Brasilc, Chilec, Uruguayc)
rm(Argentina, Argentinac, Brasil, Brasilc, Chile, Chilec, Uruguay, Uruguayc)
```

Ante todo, a la hora de trasnformar las variables de nuestro dataset, vamos a elminar las observaciones que no posean valor en la variable _formal_. Esto resulta necesario dado que nuestro objetivo general va a ser observar las diferencias en las preferencias de trabajadores formales e informales. 

```{r}
Base <- drop_na(Base, formal)
```

Posteriormente, vamos a generar dos variables categóricas que nos permitan realizar una correcta visualización de la distribución de preferencias de los encuestados de acuerdo a su nacionalidad y relación laboral. Además cambio valores de otras variables para que sean más informativas.  

```{r}
Base <- Base %>% 
  mutate(Nacionalidad = case_when(pais == 17 ~ 'Argentina', 
                                  pais == 14 ~ 'Uruguay',
                                  pais == 15 ~ 'Brasil',
                                  pais == 13 ~ 'Chile'))

  
Base <- Base %>% 
  mutate(Formalidad = case_when(formal == 1 ~ 'Formal',
                                formal == 2 ~ 'Informal'))

Base <- Base %>% 
  mutate(Protesta = case_when(prot3 == 1 ~ 'Participó',
                              prot3 == 2 ~ 'No participó'))
```

# Gráficos 

Ante todo tenemos que comenzar produciendo una serie de gráficos multi-panel que permitan observar la distribución de peferencias de acuerdo a status laboral y nacionalidad de los encuestados. Para ello vamos a usar en general _ggplot2_ y en específico la función de _facetwrap_. 

Comenzamos observando la distribución de preferencias izquierda/derecha

```{r}
Basecount <- count(Base, l1, Formalidad, Nacionalidad) 

ggplot(data = subset(Basecount, !is.na(l1)), aes(l1, n)) +
  geom_col() +
  facet_wrap(~ Formalidad) +
  labs(x = 'Ideología Política Autopercibida',
       y = 'N',
       caption = 'LAPOP') +
  theme_minimal() +
  theme(text = element_text('Avenir Next Condensed'),
        plot.caption = element_text(face = 'italic')) +
  scale_x_continuous(breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10), 
                   labels = c('Izquierda', '2', '3', '4', '5', '6', '7', '8', '9', 'Derecha'))


ggplot(Basecount, aes(l1, n)) +
  geom_col() +
  facet_wrap(~ Nacionalidad + Formalidad) +
  labs(x = 'Ideología Política Autopercibida',
       y = 'N',
       caption = 'LAPOP') +
  theme_minimal() +
  theme(text = element_text('Avenir Next Condensed'),
        plot.caption = element_text(face = 'italic')) +
    scale_x_continuous(breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10), 
                   labels = c('I', '2', '3', '4', '5', '6', '7', '8', '9', 'D'))
```

Observamos la distribución de encuestados que participaron en protestas en los últimos 12 meses. En este caso tenemos que agregar la función _subset_ para poder eliminar las observaciones con valor _NA_ en la variable _Protesta_ de nuestro gráfico.

```{r}
Basecount <- count(Base, Protesta, Formalidad, Nacionalidad) 

ggplot(data = subset(Basecount, !is.na(Protesta)), aes(Protesta, n)) +
  geom_col() +
  facet_wrap(~ Formalidad) +
  labs(x = '¿Participó en una protesta en los últimos 12 meses?',
       y = 'N',
       caption = 'LAPOP') +
  theme_minimal() +
  theme(text = element_text('Avenir Next Condensed'),
        plot.caption = element_text(face = 'italic')) 

ggplot(data = subset(Basecount, !is.na(Protesta)), aes(Protesta, n)) +
  geom_col() +
  facet_wrap(~ Nacionalidad + Formalidad) +
  labs(x = '¿Participó en una protesta en los últimos 12 meses?',
       y = 'N',
       caption = 'LAPOP') +
  theme_minimal() +
  theme(text = element_text('Avenir Next Condensed'),
        plot.caption = element_text(face = 'italic')) 
```

Observamos apoyos a políticas que permitan reducir la desigualdad. 

```{r}
# Medidas que reduzcan desigualdad ricos/pobres

Basecount <- count(Base, ros4, Formalidad, Nacionalidad)    

ggplot(Basecount, aes(ros4, n)) +
  geom_col() +
  facet_wrap(~ Formalidad) +
  labs(x = '¿Apoya políticas que reduzan la desigualdad de ingresos entre ricos y pobres?',
       y = 'N',
       caption = 'LAPOP') +
  theme_minimal() +
  theme(text = element_text('Avenir Next Condensed'),
        plot.caption = element_text(face = 'italic')) +
  scale_x_continuous(breaks = c(1:7), 
                     labels = c('En contra', '2', '3', '4', '5', '6', 'A favor'))

ggplot(Basecount, aes(ros4, n)) +
  geom_col() +
  facet_wrap(~ Nacionalidad + Formalidad) +
  labs(x = '¿Apoya políticas que reduzan la desigualdad de ingresos entre ricos y pobres?',
       y = 'N',
       caption = 'LAPOP') +
  theme_minimal() +
  theme(text = element_text('Avenir Next Condensed'),
        plot.caption = element_text(face = 'italic')) +
  scale_x_continuous(breaks = c(1:7), 
                     labels = c('En contra', '2', '3', '4', '5', '6', 'A favor'))

#Medidas de asistencia a pobres

Basecount <- count(Base, redist1, Formalidad, Nacionalidad)         

ggplot(Basecount, aes(redist1, n)) +
  geom_col() +
  facet_wrap(~ Formalidad) +
  labs(x = '¿El gobierno debe gastar más en ayudar a los pobres?',
       y = 'N',
       caption = 'LAPOP') +
  theme_minimal() +
  theme(text = element_text('Avenir Next Condensed'),
        plot.caption = element_text(face = 'italic')) +
  scale_x_continuous(breaks = c(1:7), 
                     labels = c('En contra', '2', '3', '4', '5', '6', 'A favor'))

ggplot(Basecount, aes(redist1, n)) +
  geom_col() +
  facet_wrap(~ Nacionalidad + Formalidad) +
  labs(x = '¿El gobierno debe gastar más en ayudar a los pobres?',
       y = 'N',
       caption = 'LAPOP') +
  theme_minimal() +
  theme(text = element_text('Avenir Next Condensed'),
        plot.caption = element_text(face = 'italic')) +
  scale_x_continuous(breaks = c(1:7), 
                     labels = c('En contra', '2', '3', '4', '5', '6', 'A favor'))

#Ricos pagan muchos impuestos pero reciben pocos servicios

Basecount <- count(Base, redist2a, Formalidad, Nacionalidad) 

ggplot(Basecount, aes(redist2a, n)) +
  geom_col() +
  facet_wrap(~ Formalidad) +
  labs(x = '¿Está bien que los ricos paguen muchos impuestos pero reciban pocos servicios?',
       y = 'N',
       caption = 'LAPOP') +
  theme_minimal() +
  theme(text = element_text('Avenir Next Condensed'),
        plot.caption = element_text(face = 'italic')) +
  scale_x_continuous(breaks = c(1:7), 
                     labels = c('En contra', '2', '3', '4', '5', '6', 'A favor'))

ggplot(Basecount, aes(redist2a, n)) +
  geom_col() +
  facet_wrap(~ Nacionalidad + Formalidad) +
  labs(x = '¿Está bien que los ricos paguen muchos impuestos pero reciban pocos servicios?',
       y = 'N',
       caption = 'LAPOP') +
  theme_minimal() +
  theme(text = element_text('Avenir Next Condensed'),
        plot.caption = element_text(face = 'italic')) +
  scale_x_continuous(breaks = c(1:7), 
                     labels = c('En contra', '2', '3', '4', '5', '6', 'A favor'))

# La mayoría de los desempleados podría encontrar empleo si quisiera

Basecount <- count(Base, redist3, Formalidad, Nacionalidad)

ggplot(Basecount, aes(redist3, n)) +
  geom_col() +
  facet_wrap(~ Formalidad) +
  labs(x = '¿Está de acuerdo con que la mayoría de los desempleados podría encontrar empleo si quisiera?',
       y = 'N',
       caption = 'LAPOP') +
  theme_minimal() +
  theme(text = element_text('Avenir Next Condensed'),
        plot.caption = element_text(face = 'italic')) +
  scale_x_continuous(breaks = c(1:7), 
                     labels = c('En contra', '2', '3', '4', '5', '6', 'A favor'))

ggplot(Basecount, aes(redist3, n)) +
  geom_col() +
  facet_wrap(~ Nacionalidad + Formalidad) +
  labs(x = '¿Está de acuerdo con que la mayoría de los desempleados podría encontrar empleo si quisiera?',
       y = 'N',
       caption = 'LAPOP') +
  theme_minimal() +
  theme(text = element_text('Avenir Next Condensed'),
        plot.caption = element_text(face = 'italic')) +
    scale_x_continuous(breaks = c(1:7), 
                     labels = c('En contra', '2', '3', '4', '5', '6', 'A favor'))
```

Indagamos en posibles diferencias que puedan llegar a existir en términos de participación política

```{r}

#Confianza en partidos políticos

Basecount <- count(Base, b21, Formalidad, Nacionalidad)

ggplot(Basecount, aes(b21, n)) +
  geom_col() +
  facet_wrap(~ Formalidad) +
  labs(x = '¿Hasta que punto usted tiene confianza en los partidos políticos?',
       y = 'N',
       caption = 'LAPOP') +
  theme_minimal() +
  theme(text = element_text('Avenir Next Condensed'),
        plot.caption = element_text(face = 'italic')) +
  scale_x_continuous(breaks = c(1:7), 
                     labels = c('Nada', '2', '3', '4', '5', '6', 'Mucho'))

ggplot(Basecount, aes(b21, n)) +
  geom_col() +
  facet_wrap(~ Nacionalidad + Formalidad) +
  labs(x = '¿Hasta que punto usted tiene confianza en los partidos políticos?',
       y = 'N',
       caption = 'LAPOP') +
  theme_minimal() +
  theme(text = element_text('Avenir Next Condensed'),
        plot.caption = element_text(face = 'italic')) +
    scale_x_continuous(breaks = c(1:7), 
                     labels = c('Nada', '2', '3', '4', '5', '6', 'Mucho'))

# Simpatía con partido político

Basecount <- count(Base, vb10, Formalidad, Nacionalidad)

ggplot(Basecount, aes(vb10, n)) +
  geom_col() +
  facet_wrap(~ Formalidad) +
  labs(x = '¿En este momento simpatiza con algún partido político?',
       y = 'N',
       caption = 'LAPOP') +
  theme_minimal() +
  theme(text = element_text('Avenir Next Condensed'),
        plot.caption = element_text(face = 'italic')) +
  scale_x_continuous(breaks = c(1:2), 
                     labels = c('Si', "No"))

ggplot(Basecount, aes(vb10, n)) +
  geom_col() +
  facet_wrap(~ Nacionalidad + Formalidad) +
  labs(x = '¿En este momento simpatiza con algún partido político?',
       y = 'N',
       caption = 'LAPOP') +
  theme_minimal() +
  theme(text = element_text('Avenir Next Condensed'),
        plot.caption = element_text(face = 'italic')) +
    scale_x_continuous(breaks = c(1:2), 
                     labels = c('Si', 'No'))

# Interés en política 

Basecount <- count(Base, pol1, Formalidad, Nacionalidad)

ggplot(Basecount, aes(pol1, n)) +
  geom_col() +
  facet_wrap(~ Formalidad) +
  labs(x = '¿Que tanto interés tiene usted en política?',
       y = 'N',
       caption = 'LAPOP') +
  theme_minimal() +
  theme(text = element_text('Avenir Next Condensed'),
        plot.caption = element_text(face = 'italic')) +
  scale_x_continuous(breaks = c(1:4), 
                     labels = c('Mucho', 'Algo', 'Poco', 'Nada'))

ggplot(Basecount, aes(pol1, n)) +
  geom_col() +
  facet_wrap(~ Nacionalidad + Formalidad) +
  labs(x = '¿Que tanto interés tiene usted en política?',
       y = 'N',
       caption = 'LAPOP') +
  theme_minimal() +
  theme(text = element_text('Avenir Next Condensed'),
        plot.caption = element_text(face = 'italic')) +
      scale_x_continuous(breaks = c(1:4), 
                     labels = c('Mucho', 'Algo', 'Poco', 'Nada'))

```

Finalmente, analizamos el tipo de problemas que los encuestados encuentran más relevantes en su vida diaria

```{r}

Basef <- subset(Base, Base$Formalidad == 'Formal')

a <- Basef %>% 
  group_by(a4) %>% 
  count() %>% 
  arrange(desc(n)) %>% 
  filter(n >= 200) %>% 


ggplot(a) +
  geom_bar(aes(x = a4, y = n), stat = 'identity') 

```


